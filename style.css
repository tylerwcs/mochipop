/* ===== RESET & BASE ===== */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
  width: 100%; height: 100%;
  overflow: hidden;
  touch-action: none;
  -webkit-user-select: none; user-select: none;
  font-family: 'Quicksand', 'Segoe UI', system-ui, sans-serif;
  background: linear-gradient(160deg, #fff0f5 0%, #f0f4ff 50%, #fff8e1 100%);
  color: #2d1b4e;
}

#app {
  position: relative;
  width: 100%; height: 100%;
  max-width: 600px;
  margin: 0 auto;
  overflow: hidden;
}

/* ===== SCREENS ===== */
.screen {
  position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center;
  opacity: 0; pointer-events: none;
  transition: opacity .45s ease;
  z-index: 1;
}
.screen.active { opacity: 1; pointer-events: auto; z-index: 10; }

.screen-inner {
  width: 100%; height: 100%;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 2rem 1.5rem;
  text-align: center;
}

/* ===== COLOUR TOKENS ===== */
:root {
  --c-yellow: #FFD93D;
  --c-yellow-light: #FFF3B0;
  --c-pink: #FF6B9D;
  --c-pink-light: #FFACE4;
  --c-blue: #4FC3F7;
  --c-blue-light: #B3E5FC;
  --c-bg-card: rgba(255, 255, 255, .82);
}

/* ===== BUTTONS ===== */
.btn {
  font-family: inherit;
  font-weight: 700; font-size: 1.1rem;
  border: none; border-radius: 50px;
  padding: .85rem 2.4rem;
  cursor: pointer;
  transition: transform .15s, box-shadow .15s;
  letter-spacing: .04em;
}
.btn:active { transform: scale(.95); }

.btn-primary {
  background: linear-gradient(90deg, var(--c-pink), var(--c-yellow));
  color: #fff;
  box-shadow: 0 4px 18px rgba(255,107,157,.35);
}
.btn-secondary {
  background: var(--c-bg-card);
  color: #2d1b4e;
  box-shadow: 0 2px 10px rgba(0,0,0,.08);
}

/* ===== SHARED COMPONENTS ===== */
.tap-prompt {
  margin-top: 2rem;
  font-weight: 700; font-size: 1.05rem;
  letter-spacing: .06em;
  color: var(--c-pink);
}
.pulse { animation: pulse 1.6s ease-in-out infinite; }

@keyframes pulse {
  0%, 100% { opacity: .5; transform: scale(1); }
  50%      { opacity: 1;  transform: scale(1.06); }
}

/* ===== MOCHI BASE (small decorative) ===== */
.float-mochi, .mini-mochi {
  position: relative;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
}
.fm-yellow, .mochi-yellow { background-image: url('assets/YELLOW.png'); }
.fm-pink,   .mochi-pink   { background-image: url('assets/PINK.png'); }
.fm-blue,   .mochi-blue   { background-image: url('assets/BLUE.png'); }
.mochi-bomb  { background-image: url('assets/BOMB.png'); }
.mochi-rainbow { background-image: url('assets/RAINBOW.png'); }

/* ===== ATTRACT SCREEN ===== */
.masthead-container {
  position: relative;
  width: 100%;
  max-width: 380px;
  margin-bottom: 1.5rem;
}
.masthead-img {
  width: 100%;
  height: auto;
  display: block;
  position: relative;
  z-index: 2;
}

.float-mochi {
  position: absolute;
  z-index: 3;
}
.fm-pos-1 {
  top: -8%; left: 8%;
  width: 65px; height: 65px;
  animation: floatA 3.2s ease-in-out infinite;
}
.fm-pos-2 {
  top: 15%; right: -5%;
  width: 80px; height: 80px;
  animation: floatB 3.6s ease-in-out infinite .4s;
}
.fm-pos-3 {
  bottom: -22%; left: -2%;
  width: 75px; height: 75px;
  animation: floatC 3s ease-in-out infinite .8s;
}

@keyframes floatA {
  0%, 100% { transform: translateY(0) rotate(-4deg) scale(1.25); }
  50%      { transform: translateY(-18px) rotate(4deg) scale(1.25); }
}
@keyframes floatB {
  0%, 100% { transform: translateY(0) rotate(3deg) scale(1.25); }
  50%      { transform: translateY(-22px) rotate(-3deg) scale(1.25); }
}
@keyframes floatC {
  0%, 100% { transform: translateY(0) rotate(-2deg) scale(1.25); }
  50%      { transform: translateY(-16px) rotate(5deg) scale(1.25); }
}

/* ===== INSTRUCTIONS SCREEN ===== */
.instructions-content h2 {
  font-size: 1.8rem; margin-bottom: 1.6rem;
  color: var(--c-pink);
}
.instruction-steps {
  display: flex; flex-direction: column; gap: 1.4rem;
  width: 100%; max-width: 340px;
}
.step {
  display: flex; align-items: center; gap: 1rem;
  background: var(--c-bg-card);
  border-radius: 18px;
  padding: 1rem 1.2rem;
  box-shadow: 0 2px 12px rgba(0,0,0,.05);
  text-align: left;
}
.step p { font-size: .95rem; font-weight: 600; line-height: 1.35; }

.step-icon {
  flex-shrink: 0;
  display: flex; align-items: center; gap: 4px;
  font-size: 1.6rem;
}
.step-icon.triple { gap: 2px; }
.mini-mochi { width: 28px; height: 28px; transform: scale(1.2); }
.swipe-arrow { width: 20px; height: 20px; fill: none; stroke: #7a6b8a; stroke-width: 2.2; stroke-linecap: round; stroke-linejoin: round; }


/* ===== GAMEPLAY SCREEN ===== */
#screen-gameplay {
  flex-direction: column;
  align-items: center;
  padding: 0;
}

.hud {
  width: 100%;
  display: flex; align-items: center; justify-content: space-between;
  padding: .8rem 1rem .5rem;
  background: var(--c-bg-card);
  backdrop-filter: blur(8px);
  z-index: 20;
}
.hud-cell { text-align: center; flex: 0 0 auto; }
.hud-cell.hud-timer { flex: 1 1 auto; margin: 0 .8rem; }
.hud-label { font-size: .65rem; font-weight: 700; letter-spacing: .08em; color: #a094b0; margin-bottom: 2px; }
.hud-value { font-size: 1.5rem; font-weight: 700; }
.timer-value { font-size: 1.1rem; margin-top: 2px; }

.timer-bar-track {
  width: 100%; height: 10px;
  background: #ece4f4;
  border-radius: 5px;
  overflow: hidden;
}
.timer-bar-fill {
  height: 100%; width: 100%;
  background: linear-gradient(90deg, var(--c-blue), var(--c-pink));
  border-radius: 5px;
  transition: width .3s linear;
}
.timer-bar-fill.urgent { background: linear-gradient(90deg, #ff5252, var(--c-pink)); }

#grid-container {
  flex: 1 1 auto;
  display: flex; align-items: center; justify-content: center;
  width: 100%;
  padding: .6rem;
  overflow: hidden;
}

#grid {
  position: relative;
  border-radius: 16px;
  background: var(--c-bg-card);
  box-shadow: 0 4px 24px rgba(0,0,0,.06);
  overflow: hidden;
}

/* ===== MOCHI GAME CELLS ===== */
.cell {
  position: absolute;
  padding: 0px;
  z-index: 2;
}
.cell .mochi {
  width: 100%; height: 100%;
  position: relative;
  cursor: pointer;
  will-change: transform, opacity;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  transform: scale(1.25);
}

/* pop animation */
.cell.popping .mochi {
  animation: popMochi .32s ease-out forwards;
}
@keyframes popMochi {
  0%   { transform: scale(1.25);   opacity: 1; }
  40%  { transform: scale(1.45); opacity: .7; }
  100% { transform: scale(0);   opacity: 0; }
}

/* spawn animation */
.cell.spawning .mochi {
  animation: spawnMochi .25s ease-out forwards;
}
@keyframes spawnMochi {
  0%   { transform: scale(0); }
  70%  { transform: scale(1.35); }
  100% { transform: scale(1.25); }
}

/* swap hint (selected) */
.cell.selected .mochi {
  filter: drop-shadow(0 0 8px rgba(255,107,157,.8));
}

/* ===== POWER-UP TILES ===== */
.cell.powerup-bomb .mochi,
.cell.powerup-rainbow .mochi {
  animation: powerupPulse 1.4s ease-in-out infinite;
  filter: drop-shadow(0 0 6px rgba(255, 200, 60, .6));
}
@keyframes powerupPulse {
  0%, 100% { transform: scale(1.25); filter: drop-shadow(0 0 6px rgba(255, 200, 60, .6)); }
  50%      { transform: scale(1.35); filter: drop-shadow(0 0 12px rgba(255, 200, 60, .9)); }
}

/* power-up creation flash */
.cell.powerup-created .mochi {
  animation: powerupCreate .5s ease-out forwards;
}
@keyframes powerupCreate {
  0%   { transform: scale(0.4); opacity: .5; filter: drop-shadow(0 0 20px #fff); }
  50%  { transform: scale(1.6); opacity: 1;  filter: drop-shadow(0 0 24px rgba(255, 200, 60, 1)); }
  100% { transform: scale(1.25); opacity: 1; filter: drop-shadow(0 0 6px rgba(255, 200, 60, .6)); }
}

/* ===== BOMB VFX ===== */

/* shockwave ring */
.bomb-ring {
  position: absolute;
  width: 0; height: 0;
  border-radius: 50%;
  border: 4px solid rgba(255, 140, 50, .9);
  box-shadow: 0 0 12px 4px rgba(255, 90, 30, .5), inset 0 0 8px rgba(255,200,60,.3);
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 29;
  animation: bombRingExpand .4s ease-out forwards;
}
@keyframes bombRingExpand {
  0%   { width: 0;    height: 0;    opacity: 1; border-width: 6px; }
  70%  { opacity: .7; border-width: 3px; }
  100% { width: 220px; height: 220px; opacity: 0; border-width: 1px; }
}

/* center flash */
.bomb-flash {
  position: absolute;
  width: 50px; height: 50px;
  border-radius: 50%;
  background: radial-gradient(circle, #fff 0%, rgba(255,220,100,.8) 40%, transparent 70%);
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 30;
  animation: bombFlashPop .15s ease-out forwards;
}
@keyframes bombFlashPop {
  0%   { opacity: 1; transform: translate(-50%, -50%) scale(.5); }
  50%  { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
  100% { opacity: 0; transform: translate(-50%, -50%) scale(1.4); }
}

/* ember particles */
.bomb-particle {
  position: absolute;
  width: 7px; height: 7px;
  border-radius: 50%;
  background: #ffaa30;
  box-shadow: 0 0 6px 2px rgba(255,120,30,.7);
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 29;
  animation: bombEmberFly .4s ease-out forwards;
}
.bomb-particle:nth-child(3n)   { background: #ff6030; box-shadow: 0 0 6px 2px rgba(255,60,30,.7); width: 5px; height: 5px; }
.bomb-particle:nth-child(3n+1) { background: #ffd260; box-shadow: 0 0 6px 2px rgba(255,200,60,.7); width: 8px; height: 8px; }
.bomb-particle:nth-child(5n)   { border-radius: 2px; }
@keyframes bombEmberFly {
  0%   { opacity: 1; transform: translate(-50%, -50%) rotate(0deg) translate(0, 0); }
  100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--rot)) translate(var(--dx), var(--dy)); }
}

/* grid shake */
#grid.shake {
  animation: gridShake .22s ease-out;
}
@keyframes gridShake {
  0%, 100% { transform: translate(0, 0); }
  15%      { transform: translate(-3px, 2px); }
  30%      { transform: translate(4px, -2px); }
  45%      { transform: translate(-2px, 3px); }
  60%      { transform: translate(3px, -1px); }
  75%      { transform: translate(-1px, 2px); }
}

/* ===== RAINBOW VFX ===== */

/* laser sweep lines */
.rainbow-laser-h, .rainbow-laser-v {
  position: absolute;
  pointer-events: none;
  z-index: 29;
}
.rainbow-laser-h {
  height: 36px;
  background: linear-gradient(180deg,
    transparent 0%,
    rgba(255,255,255,.15) 15%,
    rgba(255,255,255,.7) 35%,
    #fff 50%,
    rgba(255,255,255,.7) 65%,
    rgba(255,255,255,.15) 85%,
    transparent 100%);
  box-shadow: 0 0 28px 10px rgba(255,255,255,.4), 0 0 60px 20px rgba(255,255,255,.15);
  animation: rainbowSweepH .35s ease-out forwards;
}
.rainbow-laser-v {
  width: 36px;
  background: linear-gradient(90deg,
    transparent 0%,
    rgba(255,255,255,.15) 15%,
    rgba(255,255,255,.7) 35%,
    #fff 50%,
    rgba(255,255,255,.7) 65%,
    rgba(255,255,255,.15) 85%,
    transparent 100%);
  box-shadow: 0 0 28px 10px rgba(255,255,255,.4), 0 0 60px 20px rgba(255,255,255,.15);
  animation: rainbowSweepV .35s ease-out forwards;
}
@keyframes rainbowSweepH {
  0%   { opacity: 0; transform: scaleX(0); }
  20%  { opacity: 1; transform: scaleX(0.3); }
  50%  { opacity: 1; transform: scaleX(1); }
  100% { opacity: 0; transform: scaleX(1); }
}
@keyframes rainbowSweepV {
  0%   { opacity: 0; transform: scaleY(0); }
  20%  { opacity: 1; transform: scaleY(0.3); }
  50%  { opacity: 1; transform: scaleY(1); }
  100% { opacity: 0; transform: scaleY(1); }
}

/* cross flash at intersection */
.rainbow-cross-flash {
  position: absolute;
  width: 44px; height: 44px;
  border-radius: 50%;
  background: radial-gradient(circle, #fff 0%, rgba(255,220,100,.8) 35%, rgba(255,107,157,.4) 60%, transparent 75%);
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 30;
  animation: rainbowCrossFlash .25s ease-out forwards;
}
@keyframes rainbowCrossFlash {
  0%   { opacity: 1; transform: translate(-50%, -50%) scale(.3); }
  40%  { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }
  100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
}

/* spark trail particles */
.rainbow-spark {
  position: absolute;
  width: 5px; height: 5px;
  border-radius: 50%;
  background: #fff;
  box-shadow: 0 0 6px 2px rgba(255,220,100,.8);
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 29;
  animation: rainbowSparkPop .3s ease-out forwards;
}
.rainbow-spark:nth-child(3n)   { background: #ffd93d; box-shadow: 0 0 6px 2px rgba(255,217,61,.7); }
.rainbow-spark:nth-child(3n+1) { background: #ff6b9d; box-shadow: 0 0 6px 2px rgba(255,107,157,.7); }
.rainbow-spark:nth-child(3n+2) { background: #4fc3f7; box-shadow: 0 0 6px 2px rgba(79,195,247,.7); }
@keyframes rainbowSparkPop {
  0%   { opacity: 0; transform: translate(-50%, -50%) scale(0); }
  30%  { opacity: 1; transform: translate(-50%, -50%) scale(1.5); }
  100% { opacity: 0; transform: translate(-50%, -50%) scale(0.3); }
}

/* ===== COMBO DISPLAY ===== */
.combo-display {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  font-size: 2rem; font-weight: 700;
  color: var(--c-pink);
  text-shadow: 0 2px 8px rgba(255,107,157,.4);
  pointer-events: none;
  z-index: 30;
  transition: opacity .3s;
}
.combo-display.hidden { opacity: 0; }
.combo-display.visible {
  opacity: 1;
  animation: comboPopIn .5s ease-out;
}
@keyframes comboPopIn {
  0%   { transform: translate(-50%,-50%) scale(.5); opacity: 0; }
  60%  { transform: translate(-50%,-50%) scale(1.15); opacity: 1; }
  100% { transform: translate(-50%,-50%) scale(1); opacity: 1; }
}

/* score float */
.score-float {
  position: absolute;
  font-size: 1.1rem; font-weight: 700;
  color: #fff;
  text-shadow: 0 1px 6px rgba(0,0,0,.2);
  pointer-events: none;
  z-index: 25;
  animation: scoreFloat .9s ease-out forwards;
}
@keyframes scoreFloat {
  0%   { opacity: 1; transform: translateY(0) scale(1); }
  100% { opacity: 0; transform: translateY(-50px) scale(1.3); }
}

/* ===== RESULT SCREEN ===== */
.result-content {
  position: relative;
}
.result-icon { font-size: 4rem; margin-bottom: .6rem; }
.result-content h2 {
  font-size: 2.2rem; font-weight: 700;
  margin-bottom: .4rem;
}
.result-content p { font-size: 1.05rem; color: #7a6b8a; font-weight: 600; }
.result-score {
  font-size: 2.8rem; font-weight: 700;
  margin: 1rem 0;
  background: linear-gradient(135deg, var(--c-yellow), var(--c-pink));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
}
.result-buttons { display: flex; flex-direction: column; gap: .7rem; margin-top: .6rem; }

.result-content.win h2 { color: var(--c-pink); }
.result-content.lose h2 { color: var(--c-blue); }

/* confetti particles */
.confetti {
  position: absolute; width: 8px; height: 8px;
  border-radius: 2px;
  opacity: 0;
  animation: confettiFall 1.8s ease-out forwards;
}
@keyframes confettiFall {
  0%   { opacity: 1; transform: translateY(0) rotate(0deg) scale(1); }
  100% { opacity: 0; transform: translateY(120px) rotate(360deg) scale(.5); }
}

/* ===== START PAGE & LEADERBOARD ===== */
.nickname-form {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-top: 1rem;
  width: 100%;
  max-width: 250px;
}
.nickname-input {
  padding: 0.8rem 1.2rem;
  border-radius: 50px;
  border: 2px solid var(--c-blue-light);
  font-family: inherit;
  font-size: 1.1rem;
  font-weight: 600;
  text-align: center;
  color: #2d1b4e;
  outline: none;
}
.nickname-input:focus {
  border-color: var(--c-pink);
}

.leaderboard-container {
  background: var(--c-bg-card);
  border-radius: 16px;
  padding: 1rem;
  margin: 1rem 0;
  width: 100%;
  max-width: 300px;
  box-shadow: 0 2px 10px rgba(0,0,0,.05);
}
.leaderboard-container h3 {
  font-size: 1.1rem;
  color: var(--c-pink);
  margin-bottom: 0.8rem;
}
#leaderboard-list {
  list-style: none;
  padding: 0;
  text-align: left;
}
#leaderboard-list li {
  display: flex;
  justify-content: space-between;
  padding: 0.4rem 0;
  border-bottom: 1px solid #ece4f4;
  font-weight: 600;
}
#leaderboard-list li:last-child {
  border-bottom: none;
}
#leaderboard-list .rank { color: #a094b0; width: 30px; }
#leaderboard-list .name { flex: 1; color: #2d1b4e; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-right: 10px; }
#leaderboard-list .score { color: var(--c-blue); font-weight: 700; text-align: right; }

/* ===== RESPONSIVE ===== */
@media (min-width: 601px) {
  #app { border-left: 1px solid #ece4f4; border-right: 1px solid #ece4f4; }
}
@media (max-height: 580px) {
  .hud { padding: .4rem .6rem .3rem; }
  .hud-value { font-size: 1.2rem; }
  .instructions-content h2 { font-size: 1.4rem; margin-bottom: 1rem; }
  .step { padding: .7rem .9rem; }
}
